# Make Cats Free v0.3

- [Make Cats Free v0.3](#make-cats-free-v03)
  - [Список стейкхолдеров](#список-стейкхолдеров)
    - [Стейкхолдеры по группам](#стейкхолдеры-по-группам)
      - [Тесная работа](#тесная-работа)
      - [Удовлетворение потребностей](#удовлетворение-потребностей)
      - [Информирование](#информирование)
      - [Мониторинг](#мониторинг)
  - [Структура системы](#структура-системы)
    - [Сервис добавления клиентов](#сервис-добавления-клиентов)
      - [База данных добавления клиентов](#база-данных-добавления-клиентов)
    - [Сервис скоринга работников](#сервис-скоринга-работников)
      - [База данных скоринга](#база-данных-скоринга)
    - [Сервис подбора воркеров](#сервис-подбора-воркеров)
      - [База данных подбора воркеров](#база-данных-подбора-воркеров)
    - [Сервис биллинга](#сервис-биллинга)
      - [База данных биллинга](#база-данных-биллинга)
    - [Сервис оформления заказа](#сервис-оформления-заказа)
      - [База данных оформления заказа](#база-данных-оформления-заказа)
    - [Сервис контроля заказа](#сервис-контроля-заказа)
      - [База данных контроля заказа](#база-данных-контроля-заказа)
    - [Сервис сюрприз-механик для менеджеров (он же аукцион)](#сервис-сюрприз-механик-для-менеджеров-он-же-аукцион)
      - [База данных аукционов](#база-данных-аукционов)
    - [Сервис нотификаций](#сервис-нотификаций)
      - [База данных нотификаций](#база-данных-нотификаций)
    - [Система управления складом](#система-управления-складом)
  - [Предполагаемые fitness-functions](#предполагаемые-fitness-functions)
    - [Code coverage](#code-coverage)
    - [Отдел качества](#отдел-качества)
    - [Perfomance метрики](#perfomance-метрики)
    - [Security](#security)
  - [ADR](#adr)

## Список стейкхолдеров

- Топ-менеджмент
- Менеджеры
- Финотдел
- Разработчики
- Админы
- Юристы
- Клиенты

Потенциальные стейкхолдеры (нафантазированные):

- Сотрудники отдела расходников
- Поставщик fur-tune печенья

### Стейкхолдеры по группам

[Распределение на holst-е](https://app.holst.so/share/b/21aa1a15-a864-4a97-b693-c463b5b8fee8?objectId=941c3636-e2f6-4692-b1c4-f3bba6a96c2a)

#### Тесная работа

- Топ-менеджмент - высокая заинтересованность в проекте, максимальный уровень влияния, это те люди которые выделяют деньги
- Менеджеры - не только высокая заинтересованность в проекте и высокий уровень влияния, но и непосредственная вовлеченность в работу проекта

#### Удовлетворение потребностей

- Юристы - низкая заинтересованность в проекте, однако юридические консерны нужно решать с высокой приоретизацией, поскольку влияние этого внешнего фактора очень высокое

#### Информирование

- Разработчики - уровень влияния на проект сравнительно низкий, но высокая заинтересованность, к их консернам стоит прислушиваться, но не идти на поводу
- Клиенты - уровень непосредственного влияния на проект весьма низкий, но они заинтересованы в проекте (он им нужен), а так как мы продаем им продукт, к их консернам стоит прислушиваться

#### Мониторинг

- Админы - уровень влияния высокий только с технической точки зрения, как и у разработчиков, но по факту на проект особо влиять не будут, заинтересованность тоже невысокая, могут дать контекст по состоянию системы
- Финотдел - уровень влияния не очень высокий, уровень заинтересованности тоже

## Структура системы

Стиль всей системы - хореографический event-driven

Потому что ~~во-первых это красиво~~ как оказалось система уже подвергается кратно большим нагрузкам чем планировалось изначально, и это без учета того что в дальнейшем планируется расширять клиентскую базу за пределы Happy Cat Box

По факту это будет тот же набор микросервисов разной степени маленьковости, но при этом структура коммуникаций будет событийная, так как в большинстве, если не во всех сервисах не требуется синхронная коммуникация, при этом даже не смотря на возможное увеличение времени выполнения последовательных операций, с точки зрения клиента эта система будет более "отзывчивой", то есть "работать без сбоев и тупняков", по крайней мере "без тупняков"

Так как выбран распределенный микросервисный подход, единой БД не подразумевается, поэтому выбранные БД будут указаны и обоснованы в пунктах соответствующих сервисов

### Сервис добавления клиентов

Потенциально расширится до полноценного сервиса регистрации, пока что - небольшой монолит с одним методом

#### База данных добавления клиентов

Хранит данные по клиентам в БД - тут нужны консистентность и доступность, храним в реляционной

### Сервис скоринга работников

Здесь должен подойти microkernel стиль:

- Ядро в виде системы тестирования
- Плагины с особыми тестами и системами оценки

Таким образом, помимо того что будет удобно расширять логику процесса скоринга, так еще и можно будет продавать не только ядро, но и отдельные плагины, также потенциальные покупатели смогут самостоятельно добавлять нужные им тесты плагинами

#### База данных скоринга

По БД те же предпосылки и тот же вывод, что и у добавления клиентов - используем реляционную

### Сервис подбора воркеров

В соответствии с обновлением ТЗ [US-300] для этого сервиса выбран стиль pipeline, он позволит добавлять и переставлять шаги алгоритма достаточно быстро

#### База данных подбора воркеров

Собственная БД не нужна, читает данные из БД заказов и БД скоринга

### Сервис биллинга

Так как это сервис в микросервисной архитектуре, то видимо его стиль - монолит, скорее всего layered

По асинхронному каналу получает информацию о том что заказ был завершен, сохраняет в свою базу, чтобы в дальнейшем вести расчеты

По cron-у раз в месяц вызывается чтобы списать средства с клиентов и начислить средства воркерам

Информацию по инвойсам также хранит в своей бд

#### База данных биллинга

Так как нам необходимы консистентность и доступность, выбрал реляционную бд, нужно выбрать ту которая подойдет по CatFinCompliance (если этот комплаенс как-то регламентирует выбор БД)

### Сервис оформления заказа

Монолит

#### База данных оформления заказа

Нужна собственная БД для хранения "словарей" для клиента (типы услуг например)

Частое изменение данных не планируется, поэтому вероятность нарушения консистентности крайне мала, смотрим на документную БД с высокой доступностью

Помимо этого нужна также БД для хранения заказов, она будет общая с сервисом контроля заказов, нам не нужны накладные расходы производительности на разделенные БД, лучше всего подойдет реляционная, так как нам нужны доступность и консистентность

### Сервис контроля заказа

Монолит

#### База данных контроля заказа

Хранить будем данные по текущему состоянию заказа, они будут меняться часто и потенциально их будет много, точно нужна высокая доступность и скорее всего консистентность, для пользователей это важно, так что ориентируемся на реляционную бд, общую с сервисом оформления заказов

### Сервис сюрприз-механик для менеджеров (он же аукцион)

Он же [Данные &#9608;&#9608;&#9608;&#9608;&#9608;&#9608;&#9608;]

~~Секретная разработка советских ученых~~

Монолит

#### База данных аукционов

Характеристики БД выявить сложно

Спрятать один сервис еще как-то можно, спрятать сервис с доп инфрой - уже сложнее

Для максимального stelf предлагаю документную БД, в которой по событию "Заказ создан" будет записываться информация о заказе, там же и ставки менеджеров хранить

### Сервис нотификаций

Microkernel в виде ядра отправки нотификаций по почте и плагины в виде шаблонов нотификаций

То есть сервис будет получать событие с id шаблона и набором параметров, ядро знает как полученный от плагина объект отправить по почте

#### База данных нотификаций

Соответственно БД - документоориентированная, для хранения шаблонов, также можно какое-то время хранить инфу по отправленным нотификациям для тестируемости

### Система управления складом

Надо прогнуть топов на покупку CRM, мы умрем это сами писать

Нужно что-то модульное, к чему мы сможем в случае необходимости докупить/дописать плагины

## Предполагаемые fitness-functions

### Code coverage

Юнит тесты нужны на все что двигается, остальное двигать и покрывать тестами

Особенно это касается сервиса матчинга, поскольку учитывая сложность алгоритма, testability тут под вопросом при любой реализации, но так хотя бы можно удостовериться что отдельные шаги алгоритма работают ожидаемо

### Отдел качества

В требованиях уже прописан механизм оценки качества путем связи с клиентами и составления отчетов

Автоматизировать это можно постольку поскольку, так как без социальных и когнитивных усилий менеджеров тут не справиться, но мы хотя бы будем оповещать их о новых заказах, проваленных, отмененных и так далее

### Perfomance метрики

В силу асинхронности системы мы можем достоверно подсчитать только перфоманс отдельных ее элементов, но это тоже важно

### Security

Звоните пентестерам

## ADR

[В отдельном файле](/Homework3/ADR-1.md), тут и так много текста
